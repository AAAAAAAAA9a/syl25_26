<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sylwester z Jagiellońską • 2025/2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              display: ["'Poppins'", "system-ui", "sans-serif"],
              body: ["'Inter'", "system-ui", "sans-serif"],
            },
            colors: {
              midnight: "#0b1120",
              accent: "#fcd34d",
              accentPink: "#f472b6",
            },
          },
        },
      };
    </script>
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Scoped fireworks layer */
      #fireworks {
        position: fixed;
        inset: 0;
        z-index: 0;
        pointer-events: none; /* never block the card */
      }
      #fireworks .stage-container,
      #fireworks .canvas-container {
        position: absolute;
        inset: 0;
      }
      #fireworks .canvas-container { background: #000; }
      #fireworks canvas {
        position: absolute;
        width: 100%;
        height: 100%;
        mix-blend-mode: lighten;
        transform: translateZ(0);
      }
      /* Hide app UI from the fireworks demo */
      #fireworks .controls,
      #fireworks .menu,
      #fireworks .help-modal,
      #fireworks .loading-init { display: none !important; }
    </style>
  </head>
  <body class="bg-midnight font-body text-slate-100 antialiased">
    <!-- Fireworks background (behind card) -->
    <div id="fireworks" aria-hidden="true">
      <div class="loading-init">
        <div class="loading-init__header">Loading</div>
        <div class="loading-init__status">Preparing...</div>
      </div>
      <div class="stage-container">
        <div class="canvas-container">
          <canvas id="trails-canvas"></canvas>
          <canvas id="main-canvas"></canvas>
        </div>
        <!-- Minimal controls/menu markup for script expectations -->
        <div class="controls">
          <div class="btn pause-btn"><svg width="24" height="24"><use href="#icon-pause" xlink:href="#icon-pause"></use></svg></div>
          <div class="btn sound-btn"><svg width="24" height="24"><use href="#icon-sound-off" xlink:href="#icon-sound-off"></use></svg></div>
          <div class="btn settings-btn"><svg width="24" height="24"><use href="#icon-settings" xlink:href="#icon-settings"></use></svg></div>
        </div>
        <div class="menu hide">
          <div class="menu__inner-wrap">
            <div class="btn btn--bright close-menu-btn"><svg width="24" height="24"><use href="#icon-close" xlink:href="#icon-close"></use></svg></div>
            <form>
              <div class="form-option form-option--select"><label class="shell-type-label">Shell</label><select class="shell-type"></select></div>
              <div class="form-option form-option--select"><label class="shell-size-label">Size</label><select class="shell-size"></select></div>
              <div class="form-option form-option--select"><label class="quality-ui-label">Quality</label><select class="quality-ui"></select></div>
              <div class="form-option form-option--select"><label class="sky-lighting-label">Sky</label><select class="sky-lighting"></select></div>
              <div class="form-option form-option--select"><label class="scaleFactor-label">Scale</label><select class="scaleFactor"></select></div>
              <div class="form-option form-option--checkbox"><label class="auto-launch-label">Auto</label><input class="auto-launch" type="checkbox" /></div>
              <div class="form-option form-option--checkbox form-option--finale-mode"><label class="finale-mode-label">Finale</label><input class="finale-mode" type="checkbox" /></div>
              <div class="form-option form-option--checkbox"><label class="hide-controls-label">Hide</label><input class="hide-controls" type="checkbox" /></div>
              <div class="form-option form-option--checkbox form-option--fullscreen"><label class="fullscreen-label">Fullscreen</label><input class="fullscreen" type="checkbox" /></div>
              <div class="form-option form-option--checkbox"><label class="long-exposure-label">Open</label><input class="long-exposure" type="checkbox" /></div>
            </form>
          </div>
        </div>
        <div class="help-modal"><div class="help-modal__overlay"></div><div class="help-modal__dialog"><div class="help-modal__header"></div><div class="help-modal__body"></div><button type="button" class="help-modal__close-btn">Close</button></div></div>
      </div>
      <!-- Hidden SVG symbols used by the script -->
      <svg style="position:absolute;width:0;height:0;overflow:hidden">
        <symbol id="icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></symbol>
        <symbol id="icon-pause" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></symbol>
        <symbol id="icon-close" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></symbol>
        <symbol id="icon-settings" viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"></path></symbol>
        <symbol id="icon-sound-on" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></symbol>
        <symbol id="icon-sound-off" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></symbol>
      </svg>
    </div>
    <div
      class="relative flex min-h-screen items-center justify-center overflow-hidden px-6 py-16 sm:px-10 lg:px-16"
    >
      <div
        class="absolute left-[-20%] top-[-20%] h-96 w-96 rounded-full bg-gradient-to-br from-accent to-accentPink opacity-20 blur-[120px]"
        aria-hidden="true"
      ></div>
      <div
        class="absolute bottom-[-40%] right-[-10%] h-[28rem] w-[28rem] rounded-full bg-gradient-to-tr from-indigo-600 via-blue-500 to-violet-500 opacity-20 blur-[160px]"
        aria-hidden="true"
      ></div>

      <div
        class="relative z-10 mx-auto w-full max-w-4xl space-y-10 rounded-[2.5rem] border border-white/10 bg-white/5 p-12 shadow-[0_35px_120px_-45px_rgba(12,19,38,0.9)] backdrop-blur-2xl sm:p-16"
      >
        <header class="space-y-4 text-center">
          <h1
            class="font-display inline-block pb-2 text-4xl font-semibold leading-[1.15] text-transparent sm:text-5xl lg:text-6xl"
            style="
              background-image: linear-gradient(120deg, #fcd34d 0%, #f472b6 45%, #60a5fa 90%);
              background-clip: text;
              -webkit-background-clip: text;
            "
          >
            Sylwester z Jagiellońską
          </h1>
          <p class="font-display text-2xl font-semibold tracking-[0.35em] text-slate-100/70">
            2025/2026
          </p>
        </header>

        <section class="space-y-6">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-slate-100/90">
              Lista gości
            </h2>
            <span
              id="list-count"
              class="rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs font-medium text-slate-200/70"
            >
              0 osób
            </span>
          </div>

          <ul
            id="attendee-list"
            class="rounded-2xl divide-y divide-white/10"
            aria-live="polite"
            aria-relevant="all"
          ></ul>

          <p id="status" class="text-sm text-accent"></p>
        </section>
      </div>
    </div>
    <!-- Firework engine scripts -->
    <script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/329180/fscreen%401.0.1.js'></script>
    <script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/329180/Stage%400.1.4.js'></script>
    <script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/329180/MyMath.js'></script>
    <script src="firework-show/script.js"></script>
  
    <script>
      const DATA_URL = "https://jsonblob.com/api/jsonBlob/1429230376525684736";
      let people = [];
      let isMutating = false;

      const listEl = document.getElementById("attendee-list");
      const countEl = document.getElementById("list-count");
      const statusEl = document.getElementById("status");

      // Helpers for minimal avatars (initials + deterministic color)
      const getInitials = (fullName) => {
        const parts = String(fullName).trim().split(/\s+/).filter(Boolean);
        if (parts.length === 0) return "?";
        if (parts.length === 1) {
          const word = parts[0];
          return (word[0] + (word[1] || "")).toUpperCase();
        }
        return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
      };

      const stringToHsl = (str) => {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = str.charCodeAt(i) + ((hash << 5) - hash);
        }
        const hue = Math.abs(hash) % 360;
        return `hsl(${hue} 70% 65%)`;
      };

      const renderList = () => {
        listEl.innerHTML = "";

        people.forEach((name, index) => {
          const item = document.createElement("li");
          // Unified row inside a single list container
          item.className =
            "group flex items-center justify-between gap-4 px-4 py-3 transition hover:bg-white/5";

          const left = document.createElement("div");
          left.className = "flex items-center gap-3";

          const avatar = document.createElement("div");
          avatar.className =
            "flex h-8 w-8 shrink-0 items-center justify-center rounded-full text-xs font-semibold text-slate-900";
          avatar.style.backgroundColor = stringToHsl(name);
          avatar.textContent = getInitials(name);

          const nameEl = document.createElement("span");
          nameEl.className = "text-base font-medium text-slate-100";
          nameEl.textContent = name;

          left.append(avatar, nameEl);
          item.append(left);

          const removeButton = document.createElement("button");
          removeButton.type = "button";
          removeButton.className =
            "inline-flex items-center gap-2 rounded-lg px-3 py-2 text-xs font-medium tracking-wide text-slate-300 hover:text-rose-200 focus:outline-none focus:ring-2 focus:ring-rose-300/40 opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity";
          removeButton.innerHTML =
            '<svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg><span class="sr-only">Usuń</span>';
          removeButton.addEventListener("click", async () => {
            removeButton.disabled = true;
            removeButton.setAttribute("aria-disabled", "true");
            isMutating = true;
            try {
              const nextPeople = people.filter((_, idx) => idx !== index);
              const response = await fetch(DATA_URL, {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ people: nextPeople }),
              });
              if (!response.ok) {
                throw new Error("Błąd sieci");
              }
              people = nextPeople;
              renderList();
              statusEl.textContent = "";
            } catch (error) {
              statusEl.textContent =
                "Nie udało się usunąć wpisu. Odśwież stronę i spróbuj ponownie.";
              removeButton.disabled = false;
              removeButton.removeAttribute("aria-disabled");
            } finally {
              isMutating = false;
            }
          });

          item.append(removeButton);
          listEl.append(item);
        });

        const formItem = document.createElement("li");
        formItem.className = "px-5 py-5";

        const form = document.createElement("form");
        form.className = "flex flex-col gap-3 sm:flex-row sm:items-end";
        form.setAttribute("aria-label", "Dodaj gościa");

        const inputWrapper = document.createElement("div");
        inputWrapper.className = "flex-1";

        const label = document.createElement("label");
        label.htmlFor = "name-input";
        // Keep for accessibility but visually hide
        label.className = "sr-only";
        label.textContent = "Imię i nazwisko";

        const input = document.createElement("input");
        input.type = "text";
        input.name = "name";
        input.required = true;
        input.placeholder = "Imię i nazwisko";
        input.autocomplete = "name";
        input.setAttribute("aria-label", "Imię i nazwisko nowej osoby na liście");
        input.id = "name-input";
        input.className =
          "w-full rounded-xl border border-white/10 bg-white/90 px-4 py-3 text-sm font-medium text-slate-900 placeholder:text-slate-500 focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/60";

        inputWrapper.append(label, input);

        const button = document.createElement("button");
        button.type = "submit";
        button.className =
          "inline-flex items-center justify-center rounded-xl bg-slate-200 px-5 py-3 text-sm font-semibold text-slate-900 transition hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-slate-200 disabled:cursor-not-allowed disabled:opacity-50";
        button.textContent = "Dodaj";
        button.disabled = true;

        form.append(inputWrapper, button);
        formItem.append(form);
        listEl.append(formItem);

        form.addEventListener("submit", async (event) => {
          event.preventDefault();
          const formData = new FormData(form);
          const name = formData.get("name");
          if (!name) {
            return;
          }

          button.disabled = true;
          const prevText = button.textContent;
          button.textContent = "Dodaję...";
          isMutating = true;

          try {
            const nextPeople = [...people, String(name).trim()].filter(Boolean);
            const response = await fetch(DATA_URL, {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ people: nextPeople }),
            });

            if (!response.ok) {
              throw new Error("Błąd sieci");
            }

            people = nextPeople;
            renderList();
            statusEl.textContent = "";
            input.value = "";
          } catch (error) {
            statusEl.textContent =
              "Nie udało się zapisać. Odśwież stronę i spróbuj ponownie.";
            button.disabled = false;
            button.textContent = prevText;
          } finally {
            isMutating = false;
          }
        });

        // Enable/disable button based on trimmed input value
        input.addEventListener("input", () => {
          const hasValue = input.value.trim().length > 0;
          button.disabled = !hasValue;
        });

        countEl.textContent =
          people.length === 1
            ? "1 osoba"
            : `${people.length} ${people.length % 10 === 1 && people.length !== 11 ? "osoba" : people.length % 10 >= 2 && people.length % 10 <= 4 && (people.length < 10 || people.length > 20) ? "osoby" : "osób"}`;
      };

      const fetchPeople = async () => {
        if (isMutating) {
          return;
        }
        try {
          const response = await fetch(DATA_URL, { cache: "no-store" });
          if (!response.ok) {
            throw new Error("Nie udało się pobrać listy");
          }
          const data = await response.json();
          people = Array.isArray(data.people) ? data.people : [];
          renderList();
        } catch (error) {
          statusEl.textContent =
            "Nie udało się pobrać listy. Spróbuj odświeżyć stronę.";
          people = [];
          renderList();
        }
      };

      fetchPeople();
      setInterval(fetchPeople, 15000);
    </script>
  </body>
</html>
